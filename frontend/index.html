<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#2a004f">
    <title>HoroHelper Tracker</title>
    <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="icons/icon-192x192.png">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Data Tracker</h1>
            <div class="nav-buttons">
                <a href="stats.html" class="nav-link">Stats ðŸ“‹</a>
                <button class="hamburger-menu" id="hamburger-btn" aria-label="Menu">
                    <span class="hamburger-line"></span>
                    <span class="hamburger-line"></span>
                    <span class="hamburger-line"></span>
                </button>
            </div>
        </div>
        <nav class="dropdown-menu" id="dropdown-menu">
            <a href="register.html" class="dropdown-item" id="register-link" style="display: none;">Register User ðŸ‘¥</a>
            <a href="#" id="logout-btn" class="dropdown-item">Logout ðŸšª</a>
        </nav>
        <div class="datetime-container">
            <input type="date" id="current-date">
            <input type="time" id="current-time">
            <div class="mode-selector">
                <button class="mode-btn active" data-mode="health">Health</button>
                <button class="mode-btn" data-mode="jab">Jab</button>
                <button class="mode-btn" data-mode="measurements">Body</button>
            </div>
        </div>
        <form id="tracker-form">
            <div id="health-fields">
                <div class="form-group roller-group">
                    <label>Weight (kg)</label>
                    <div class="compound-roller" data-field="weight">
                        <div class="roller" data-part="int" data-min="0" data-max="200" data-value="70"></div>
                        <span class="separator">.</span>
                        <div class="roller" data-part="dec" data-min="0" data-max="9" data-value="0"></div>
                    </div>
                </div>
                <div class="form-group roller-group">
                    <label>Body Fat (%)</label>
                    <div class="compound-roller" data-field="body_fat">
                        <div class="roller" data-part="int" data-min="0" data-max="100" data-value="15"></div>
                        <span class="separator">.</span>
                        <div class="roller" data-part="dec" data-min="0" data-max="9" data-value="0"></div>
                    </div>
                </div>
                <div class="form-group roller-group">
                    <label>Muscle (%)</label>
                    <div class="compound-roller" data-field="muscle">
                        <div class="roller" data-part="int" data-min="0" data-max="100" data-value="40"></div>
                        <span class="separator">.</span>
                        <div class="roller" data-part="dec" data-min="0" data-max="9" data-value="0"></div>
                    </div>
                </div>
                <div class="form-group roller-group">
                    <label>Visceral Fat</label>
                    <div class="roller" data-field="visceral_fat" data-part="int" data-min="1" data-max="59" data-value="10"></div>
                </div>
                <div class="form-group roller-group">
                    <label>Sleep (hours)</label>
                    <div class="compound-roller" data-field="sleep">
                        <div class="roller" data-part="int" data-min="0" data-max="23" data-value="7"></div>
                        <span class="separator">.</span>
                        <div class="roller" data-part="dec" data-min="0" data-max="9" data-value="5"></div>
                    </div>
                </div>
            </div>
            <div id="jab-fields" style="display: none;">
                <div class="form-group roller-group">
                    <label>Dose (mg)</label>
                    <div class="compound-roller" data-field="dose">
                        <div class="roller" data-part="int" data-min="0" data-max="100" data-value="2"></div>
                        <span class="separator">.</span>
                        <div class="roller" data-part="dec" data-min="0" data-max="9" data-value="5"></div>
                    </div>
                </div>
            </div>
            <div id="measurement-fields" style="display: none;">
                <div class="form-group roller-group">
                    <label>Upper Arm Left (cm)</label>
                    <div class="compound-roller" data-field="upper_arm_left">
                        <div class="roller" data-part="int" data-min="0" data-max="100" data-value="30"></div>
                        <span class="separator">.</span>
                        <div class="roller" data-part="dec" data-min="0" data-max="9" data-value="0"></div>
                    </div>
                </div>
                <div class="form-group roller-group">
                    <label>Upper Arm Right (cm)</label>
                    <div class="compound-roller" data-field="upper_arm_right">
                        <div class="roller" data-part="int" data-min="0" data-max="100" data-value="30"></div>
                        <span class="separator">.</span>
                        <div class="roller" data-part="dec" data-min="0" data-max="9" data-value="0"></div>
                    </div>
                </div>
                <div class="form-group roller-group">
                    <label>Chest (cm)</label>
                    <div class="compound-roller" data-field="chest">
                        <div class="roller" data-part="int" data-min="0" data-max="200" data-value="90"></div>
                        <span class="separator">.</span>
                        <div class="roller" data-part="dec" data-min="0" data-max="9" data-value="0"></div>
                    </div>
                </div>
                <div class="form-group roller-group">
                    <label>Waist (cm)</label>
                    <div class="compound-roller" data-field="waist">
                        <div class="roller" data-part="int" data-min="0" data-max="200" data-value="80"></div>
                        <span class="separator">.</span>
                        <div class="roller" data-part="dec" data-min="0" data-max="9" data-value="0"></div>
                    </div>
                </div>
                <div class="form-group roller-group">
                    <label>Thigh Left (cm)</label>
                    <div class="compound-roller" data-field="thigh_left">
                        <div class="roller" data-part="int" data-min="0" data-max="100" data-value="50"></div>
                        <span class="separator">.</span>
                        <div class="roller" data-part="dec" data-min="0" data-max="9" data-value="0"></div>
                    </div>
                </div>
                <div class="form-group roller-group">
                    <label>Thigh Right (cm)</label>
                    <div class="compound-roller" data-field="thigh_right">
                        <div class="roller" data-part="int" data-min="0" data-max="100" data-value="50"></div>
                        <span class="separator">.</span>
                        <div class="roller" data-part="dec" data-min="0" data-max="9" data-value="0"></div>
                    </div>
                </div>
                <div class="form-group roller-group">
                    <label>Face (cm)</label>
                    <div class="compound-roller" data-field="face">
                        <div class="roller" data-part="int" data-min="0" data-max="100" data-value="20"></div>
                        <span class="separator">.</span>
                        <div class="roller" data-part="dec" data-min="0" data-max="9" data-value="0"></div>
                    </div>
                </div>
                <div class="form-group roller-group">
                    <label>Neck (cm)</label>
                    <div class="compound-roller" data-field="neck">
                        <div class="roller" data-part="int" data-min="0" data-max="100" data-value="35"></div>
                        <span class="separator">.</span>
                        <div class="roller" data-part="dec" data-min="0" data-max="9" data-value="0"></div>
                    </div>
                </div>
            </div>
            <div class="form-group">
                <label for="notes">Notes</label>
                <textarea id="notes" name="notes" rows="3"></textarea>
            </div>
            <button type="submit" id="submit-btn">Save Log</button>
        </form>
        <p id="message"></p>
    </div>
    <script src="app.js"></script>
    <script>
        // Check if user is admin and show register link
        async function checkAdminStatus() {
            try {
                const response = await fetch('/api/auth/me');
                if (response.ok) {
                    const user = await response.json();
                    // Show register link if user is admin
                    if (user.is_admin) {
                        document.getElementById('register-link').style.display = 'inline';
                    }
                }
            } catch (error) {
                console.error('Failed to check admin status:', error);
            }
        }

        // Check admin status on page load
        checkAdminStatus();

        // Hamburger menu functionality
        const hamburgerBtn = document.getElementById('hamburger-btn');
        const dropdownMenu = document.getElementById('dropdown-menu');

        hamburgerBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            dropdownMenu.classList.toggle('show');
            hamburgerBtn.classList.toggle('active');
        });

        // Close dropdown when clicking outside
        document.addEventListener('click', (e) => {
            if (!hamburgerBtn.contains(e.target) && !dropdownMenu.contains(e.target)) {
                dropdownMenu.classList.remove('show');
                hamburgerBtn.classList.remove('active');
            }
        });

        // Logout functionality
        document.getElementById('logout-btn').addEventListener('click', async (e) => {
            e.preventDefault();
            try {
                await fetch('/api/auth/logout', { method: 'POST' });
                window.location.href = '/login.html';
            } catch (error) {
                console.error('Logout failed:', error);
                window.location.href = '/login.html';
            }
        });

        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js').then(registration => {
                    console.log('ServiceWorker registration successful with scope: ', registration.scope);
                }, err => {
                    console.log('ServiceWorker registration failed: ', err);
                });
            });
        }
    </script>
</body>
</html>
